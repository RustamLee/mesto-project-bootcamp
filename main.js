(()=>{"use strict";var e,t=document.querySelectorAll(".popup"),n=document.querySelector(".profile__edit-button"),o=document.querySelector(".popup__profile"),c=document.querySelector(".popup-new-place"),r=document.querySelector(".popup-image"),a=document.querySelector(".popup__avatar"),i=document.querySelector(".profile__avatar-button"),u=document.querySelector(".profile__add-button"),s=document.querySelector(".profile__info-name"),l=o.querySelector("#profile-name"),d=document.querySelector(".profile__info-subtitle"),p=o.querySelector("#profile-job"),f=document.querySelector(".content"),m=c.querySelector("#new-place-name"),v=c.querySelector("#new-place-src"),h=o.querySelector(".popup__edit-profile"),_=c.querySelector(".popup__edit-profile"),y=document.querySelector("#edit-avatar"),S=document.querySelector("#avatar-edit"),b=document.querySelector(".profile__avatar");function q(e){e.classList.remove("popup_opened"),document.removeEventListener("keydown",g)}function k(e){e.classList.add("popup_opened"),document.addEventListener("keydown",g)}function g(e){"Escape"===e.key&&q(document.querySelector(".popup_opened"))}function C(t){var n=document.getElementById("content-item").content.querySelector(".content__item").cloneNode(!0),o=n.querySelector(".content__item-image"),c=n.querySelector(".content__trash"),a=n.querySelector(".content__like-counter"),i=n.querySelector(".content__like");return n.querySelector(".content__title").textContent=t.name,o.alt=t.name,o.src=t.link,n.id=t._id,a.textContent=Number(t.likes.length),i.addEventListener("click",(function(e){i.classList.contains("content__like_active")?(i.classList.remove("content__like_active"),function(e){fetch("https://nomoreparties.co/v1/wbc-cohort-1/cards/likes/".concat(e.id),{method:"DELETE",headers:{authorization:"3dd89b95-5c6a-443c-a15c-23b145a16389","Content-Type":"application/json"},body:JSON.stringify({})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(t){console.log(t.likes.length),e.querySelector(".content__like-counter").textContent=Number(t.likes.length)}))}(n)):(i.classList.add("content__like_active"),function(e){fetch("https://nomoreparties.co/v1/wbc-cohort-1/cards/likes/".concat(e.id),{method:"PUT",headers:{authorization:"3dd89b95-5c6a-443c-a15c-23b145a16389","Content-Type":"application/json"},body:JSON.stringify({})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(t){console.log(t.likes.length),e.querySelector(".content__like-counter").textContent=Number(t.likes.length)}))}(n))})),0!==t.likes.length&&t.likes.forEach((function(t){t._id===e&&i.classList.add("content__like_active")})),t.owner._id!==e?c.remove():c.addEventListener("click",(function(){!function(e){return(t=e.id,fetch("https://nomoreparties.co/v1/wbc-cohort-1/cards/".concat(t),{method:"DELETE",headers:{authorization:"3dd89b95-5c6a-443c-a15c-23b145a16389","Content-Type":"application/json"}}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))).then((function(){e.remove()})).catch((function(e){console.log(e)}));var t}(n)})),o.addEventListener("click",(function(e){r.querySelector(".popup-image__container").src=e.target.src,r.querySelector(".popup-image__name").textContent=e.target.alt,k(r)})),n}function E(){fetch("https://nomoreparties.co/v1/wbc-cohort-1/users/me",{headers:{authorization:"3dd89b95-5c6a-443c-a15c-23b145a16389"}}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(t){s.textContent=t.name,d.textContent=t.about,b.style.backgroundImage="url(".concat(t.avatar,")"),e=t._id})).catch((function(e){console.log(e)}))}t.forEach((function(e){e.addEventListener("mousedown",(function(t){t.target.classList.contains("popup_opened")&&q(e),t.target.classList.contains("popup__close")&&q(e)}))})),fetch("https://nomoreparties.co/v1/wbc-cohort-1/cards",{headers:{authorization:"3dd89b95-5c6a-443c-a15c-23b145a16389"}}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(e){e.forEach((function(e){f.prepend(C(e))}))})).catch((function(e){console.log(e)}));var L=function(e,t){var n=document.getElementById("".concat(e.id,"-error"));e.classList.remove(t.inputErrorClass),n.classList.remove(t.errorClass),n.textContent=""},j=function(e,t){var n=Array.from(e.querySelectorAll(t.inputSelector)),o=e.querySelector(t.submitButtonSelector);n.forEach((function(e){L(e,t)})),x(o,t)};function x(e,t){var n=t.inactiveButtonClass;e.classList.add(n),e.disabled=!0}function w(e,t,n){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?function(e,t){var n=t.inactiveButtonClass;e.classList.remove(n),e.disabled=!1}(t,n):x(t,n)}E(),i.addEventListener("click",(function(e){S.value="",j(y,T),k(a)})),y.addEventListener("submit",(function(e){var t=y.querySelector("#save-avatar");t.textContent="Сохранение...",e.preventDefault(),fetch("https://nomoreparties.co/v1/wbc-cohort-1/users/me/avatar",{method:"PATCH",headers:{authorization:"3dd89b95-5c6a-443c-a15c-23b145a16389","Content-Type":"application/json"},body:JSON.stringify({avatar:S.value})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(e){console.log(e)})),t.textContent="Сохранить",b.style.backgroundImage="url(".concat(S.value,")"),q(a)})),n.addEventListener("click",(function(e){l.value=s.textContent,p.value=d.textContent,j(h,T),k(o)})),h.addEventListener("submit",(function(e){var t=h.querySelector("#save-profile");t.textContent="Сохранение...",e.preventDefault(),fetch("https://nomoreparties.co/v1/wbc-cohort-1/users/me",{method:"PATCH",headers:{authorization:"3dd89b95-5c6a-443c-a15c-23b145a16389","Content-Type":"application/json"},body:JSON.stringify({name:l.value,about:p.value})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(e){E()})),t.textContent="Сохранить",q(o)})),u.addEventListener("click",(function(e){m.value="",v.value="",j(_,T),k(c)})),_.addEventListener("submit",(function(e){var t=_.querySelector("#add-place");t.textContent="Сохранение...",e.preventDefault(),fetch("https://nomoreparties.co/v1/wbc-cohort-1/cards",{method:"POST",headers:{authorization:"3dd89b95-5c6a-443c-a15c-23b145a16389","Content-Type":"application/json"},body:JSON.stringify({name:m.value,link:v.value})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(e){f.prepend(C(e))})),t.textContent="Сохранить",m.value="",v.value="",q(c)}));var P,T={formSelector:".popup__edit-profile",inputSelector:".popup__container-field",submitButtonSelector:".popup__container-button",inactiveButtonClass:"popup__container-button_disabled",inputErrorClass:"popup__container-field_error",errorClass:"popup__input-error_active"};P=T,Array.from(document.querySelectorAll(P.formSelector)).forEach((function(e){!function(e,t){var n=Array.from(e.querySelectorAll(t.inputSelector)),o=e.querySelector(t.submitButtonSelector);w(n,o,t),n.forEach((function(e){e.addEventListener("input",(function(){(function(e,t){e.validity.valid?L(e,t):function(e,t,n){var o=document.getElementById("".concat(e.id,"-error"));console.log(o),e.classList.add(t.inputErrorClass),o.classList.add(t.errorClass),o.textContent=n}(e,t,e.validationMessage)})(e,t),w(n,o,t)}))}))}(e,P)}))})();